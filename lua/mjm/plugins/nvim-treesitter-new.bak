-- MAYBE: Re-create the parameter TS-TextObjects
-- FUTURE: Test TS-Indent again

local ts = require("nvim-treesitter")
ts.setup({
    install_dir = vim.fn.stdpath("data") .. "/site",
})

local languages = {
    -- Mandatory
    "c",
    "lua",
    "vim",
    "vimdoc",
    "query",
    "markdown_inline",
    "markdown",
    -- Optional
    "c_sharp",
    "bash",
    "css",
    "javascript",
    "json",
    "go",
    "html",
    "perl",
    "python",
    "rust",
    "sql",
    "typescript",
}
ts.install(languages)

vim.api.nvim_create_autocmd({ "FileType" }, {
    group = vim.api.nvim_create_augroup("ts-start", { clear = true }),
    pattern = "*",
    callback = function(ev)
        if vim.tbl_contains(languages, ev.match) then
            vim.treesitter.start()
        end

        -- vim.bo[ev.buf].indentexpr = "v:lua.require'nvim-treesitter'.indentexpr()"
    end,
})

-- Defer execution until after Neovim automatically executes packadd. I have the vim.pack step
-- to do so early disabled
vim.api.nvim_create_autocmd("VimEnter", {
    group = vim.api.nvim_create_augroup("run-tsupdate", { clear = true }),
    pattern = "*",
    callback = function()
        vim.schedule_wrap(function()
            vim.cmd("TSUpdate")
        end)
    end,
})
